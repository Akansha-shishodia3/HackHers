{% extends "jobbase.html" %}
{% block body %}
<div class="container-fluid">
  <div class="row">
    <div class="col-sm-12 ms-2">
      <div class="shadow borderani" style="border: 4px solid #2f2965; padding: 20px;">
        <h4 style="color: #2f2965; text-align: center;">Interview Result</h4>
        <p class="text-center text-muted">
          Taken on: {{ result.date_taken|date:"F d, Y, P" }}
        </p>
        <hr class="border border-secondary border-2 opacity-50" style="width: 70%; margin-left: 15%;">

        <div style="width: 90%; margin: 0 auto;">
          <div class="card mb-4">
            <div class="card-header fw-bold">
              Interview Summary
            </div>
            <div class="card-body">
              <p><strong>Type:</strong> {{ result.interview_type }}</p>
              <p><strong>Details:</strong> {{ result.interview_details }}</p>
              <p><strong>Difficulty:</strong> {{ result.difficulty }}</p>

              {% if result.status != 'Pending' and result.status != 'Incomplete' %}
              <hr>
              <div class="row text-center">
                  <div class="col-md-6">
                      <h6 class="text-muted">Overall Score</h6>
                      <h4 class="fw-bold {% if result.status == 'Passed' %}text-success{% else %}text-danger{% endif %}">
                          {% widthratio result.overall_score 1 100 %}%
                      </h4>
                  </div>
                  <div class="col-md-6">
                      <h6 class="text-muted">Final Status</h6>
                      <h4>
                          {% if result.status == 'Passed' %}
                              <span class="badge rounded-pill bg-success fs-6">{{ result.get_status_display }}</span>
                          {% elif result.status == 'Failed' %}
                              <span class="badge rounded-pill bg-danger fs-6">{{ result.get_status_display }}</span>
                          {% endif %}
                      </h4>
                  </div>
              </div>
              {% endif %}
            </div>
          </div>

          <h5 class="mb-3" style="color: #2f2965;">Questions & Answers</h5>

          {% for qa in result.results %}
          <div class="accordion" id="accordion-{{ forloop.counter }}">
            <div class="accordion-item mb-3">
              <h2 class="accordion-header" id="heading-{{ forloop.counter }}">
                <button class="accordion-button fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ forloop.counter }}" aria-expanded="true" aria-controls="collapse-{{ forloop.counter }}">
                  Question {{ forloop.counter }}: {{ qa.question }}
                </button>
              </h2>
              <div id="collapse-{{ forloop.counter }}" class="accordion-collapse collapse show" aria-labelledby="heading-{{ forloop.counter }}">
                <div class="accordion-body">
                  {% if qa.score is not None %}
                  <div class="mb-3">
                      <h6 class="text-muted">Similarity Score</h6>
                      <div class="progress" style="height: 20px;">
                          <div class="progress-bar fw-bold {% if qa.score >= 0.7 %}bg-success{% elif qa.score >= 0.5 %}bg-warning{% else %}bg-danger{% endif %}" 
                               role="progressbar" 
                               style="width: {% widthratio qa.score 1 100 %}%;" 
                               aria-valuenow="{% widthratio qa.score 1 100 %}" 
                               aria-valuemin="0" 
                               aria-valuemax="100">
                               {% widthratio qa.score 1 100 %}%
                          </div>
                      </div>
                  </div>
                  {% endif %}
                  <div class="mb-3">
                    <h6 class="text-primary">Your Answer:</h6>
                    <p style="white-space: pre-wrap;">{% if qa.user_answer %}{{ qa.user_answer }}{% else %}<em>No answer provided.</em>{% endif %}</p>
                  </div>
                  <hr>
                  <div>
                    <h6 class="text-success">Ideal Answer:</h6>
                    <p style="white-space: pre-wrap;">{{ qa.ideal_answer }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% empty %}
          <div class="alert alert-warning">No questions and answers were recorded for this interview.</div>
          {% endfor %}

          <div class="text-center mt-4">
            <a href="{% url 'interview_history' %}" class="btn btn-secondary">
              <i class="fa-solid fa-arrow-left"></i> Back to Interview History
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock body %}